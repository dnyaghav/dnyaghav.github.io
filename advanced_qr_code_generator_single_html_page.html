<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced QR Code Generator</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- QRCode Styling (supports logos, shapes, etc.) -->
    <script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>

    <style>
      body { background: #0f172a; color: #e2e8f0; }
      .app-card { background: #111827; border: 1px solid #1f2937; }
      .qr-wrap { min-height: 320px; display: grid; place-items: center; background: #0b1220; border: 1px dashed #334155; border-radius: .75rem; }
      .form-label { font-weight: 600; }
      .form-text { color: #9ca3af !important; }
      .badge-soft { background: #0b1220; color: #a5b4fc; border: 1px solid #312e81; }
      .btn-outline-light { border-color:#374151; }
      .footer { color:#9ca3af; }
      .range-output { min-width: 3ch; display:inline-block; text-align:right; }
      a, .link-light { text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="container py-4 py-md-5">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <h1 class="h3 mb-1">Advanced QR Code Generator</h1>
          <div class="small text-secondary">Single-file • Bootstrap 5 • Logo • Shapes • PNG/SVG • Error Correction</div>
        </div>
        <span class="badge badge-soft rounded-pill px-3 py-2">Client-side Only</span>
      </div>

      <div class="row g-4">
        <!-- Left: Controls -->
        <div class="col-12 col-lg-6">
          <div class="card app-card p-3 p-md-4">
            <ul class="nav nav-pills mb-3" id="dataTabs" role="tablist">
              <li class="nav-item" role="presentation"><button class="nav-link active" id="tab-text" data-bs-toggle="pill" data-bs-target="#pane-text" type="button" role="tab">Text / URL</button></li>
              <li class="nav-item" role="presentation"><button class="nav-link" id="tab-wifi" data-bs-toggle="pill" data-bs-target="#pane-wifi" type="button" role="tab">Wi‑Fi</button></li>
              <li class="nav-item" role="presentation"><button class="nav-link" id="tab-vcard" data-bs-toggle="pill" data-bs-target="#pane-vcard" type="button" role="tab">vCard</button></li>
              <li class="nav-item" role="presentation"><button class="nav-link" id="tab-sms" data-bs-toggle="pill" data-bs-target="#pane-sms" type="button" role="tab">SMS</button></li>
              <li class="nav-item" role="presentation"><button class="nav-link" id="tab-email" data-bs-toggle="pill" data-bs-target="#pane-email" type="button" role="tab">Email</button></li>
            </ul>

            <div class="tab-content" id="dataTabsContent">
              <!-- Text / URL -->
              <div class="tab-pane fade show active" id="pane-text" role="tabpanel" aria-labelledby="tab-text">
                <div class="mb-3">
                  <label class="form-label" for="textContent">Text or URL</label>
                  <textarea id="textContent" class="form-control" rows="3" placeholder="https://example.com or any text"></textarea>
                  <div class="form-text">Anything you type here becomes the QR payload.</div>
                </div>
              </div>

              <!-- WiFi -->
              <div class="tab-pane fade" id="pane-wifi" role="tabpanel" aria-labelledby="tab-wifi">
                <div class="row g-3">
                  <div class="col-md-6"><label class="form-label" for="wifiSsid">SSID</label><input id="wifiSsid" class="form-control" placeholder="Network name" /></div>
                  <div class="col-md-6"><label class="form-label" for="wifiPass">Password</label><input id="wifiPass" class="form-control" placeholder="Password" /></div>
                  <div class="col-md-6">
                    <label class="form-label" for="wifiAuth">Security</label>
                    <select id="wifiAuth" class="form-select">
                      <option value="WPA">WPA/WPA2/WPA3</option>
                      <option value="WEP">WEP</option>
                      <option value="nopass">Open (no password)</option>
                    </select>
                  </div>
                  <div class="col-md-6 d-flex align-items-end">
                    <div class="form-check mt-3">
                      <input class="form-check-input" type="checkbox" id="wifiHidden" />
                      <label class="form-check-label" for="wifiHidden">Hidden network</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- vCard -->
              <div class="tab-pane fade" id="pane-vcard" role="tabpanel" aria-labelledby="tab-vcard">
                <div class="row g-3">
                  <div class="col-md-6"><label class="form-label" for="vFirst">First name</label><input id="vFirst" class="form-control" /></div>
                  <div class="col-md-6"><label class="form-label" for="vLast">Last name</label><input id="vLast" class="form-control" /></div>
                  <div class="col-md-6"><label class="form-label" for="vPhone">Phone</label><input id="vPhone" class="form-control" placeholder="+91 98765 43210" /></div>
                  <div class="col-md-6"><label class="form-label" for="vEmail">Email</label><input id="vEmail" class="form-control" placeholder="you@example.com" /></div>
                  <div class="col-12"><label class="form-label" for="vOrg">Company</label><input id="vOrg" class="form-control" /></div>
                  <div class="col-12"><label class="form-label" for="vTitle">Title</label><input id="vTitle" class="form-control" /></div>
                  <div class="col-12"><label class="form-label" for="vAddr">Address</label><input id="vAddr" class="form-control" /></div>
                  <div class="col-12"><label class="form-label" for="vUrl">Website</label><input id="vUrl" class="form-control" placeholder="https://" /></div>
                </div>
                <div class="form-text mt-2">Encodes a vCard 3.0 contact.</div>
              </div>

              <!-- SMS -->
              <div class="tab-pane fade" id="pane-sms" role="tabpanel" aria-labelledby="tab-sms">
                <div class="row g-3">
                  <div class="col-md-6"><label class="form-label" for="smsTo">To (Phone)</label><input id="smsTo" class="form-control" placeholder="+91..." /></div>
                  <div class="col-12"><label class="form-label" for="smsMsg">Message</label><textarea id="smsMsg" class="form-control" rows="2"></textarea></div>
                </div>
              </div>

              <!-- Email -->
              <div class="tab-pane fade" id="pane-email" role="tabpanel" aria-labelledby="tab-email">
                <div class="row g-3">
                  <div class="col-md-6"><label class="form-label" for="emTo">To</label><input id="emTo" class="form-control" placeholder="you@example.com" /></div>
                  <div class="col-md-6"><label class="form-label" for="emSubject">Subject</label><input id="emSubject" class="form-control" /></div>
                  <div class="col-12"><label class="form-label" for="emBody">Body</label><textarea id="emBody" class="form-control" rows="2"></textarea></div>
                </div>
              </div>
            </div>

            <hr class="my-4" />

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="size">Size <span class="range-output" id="sizeOut">300</span> px</label>
                <input type="range" class="form-range" min="180" max="1024" step="10" id="size" value="300" />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="margin">Margin <span class="range-output" id="marginOut">10</span> px</label>
                <input type="range" class="form-range" min="0" max="40" step="1" id="margin" value="10" />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="ecc">Error Correction</label>
                <select id="ecc" class="form-select">
                  <option value="L">L (7%)</option>
                  <option value="M" selected>M (15%)</option>
                  <option value="Q">Q (25%)</option>
                  <option value="H">H (30%)</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Dot Style</label>
                <select id="dotStyle" class="form-select">
                  <option value="square">Square</option>
                  <option value="dots">Dots</option>
                  <option value="rounded">Rounded</option>
                  <option value="extra-rounded">Extra Rounded</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="fg">Foreground</label>
                <input type="color" id="fg" class="form-control form-control-color" value="#111827" />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="bg">Background</label>
                <input type="color" id="bg" class="form-control form-control-color" value="#ffffff" />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="logo">Logo (PNG/JPG/SVG)</label>
                <input class="form-control" type="file" id="logo" accept="image/*,.svg" />
                <div class="form-text">Optional center logo overlay.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="logoSize">Logo Size <span class="range-output" id="logoOut">0.25</span></label>
                <input type="range" class="form-range" min="0" max="0.5" step="0.01" id="logoSize" value="0.25" />
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mt-3">
              <button class="btn btn-primary" id="btnGenerate">Generate</button>
              <button class="btn btn-outline-light" id="btnRefresh" title="Re-render with current options">Refresh</button>
              <div class="vr d-none d-md-block"></div>
              <button class="btn btn-success" id="btnDownloadPng">Download PNG</button>
              <button class="btn btn-success" id="btnDownloadSvg">Download SVG</button>
              <button class="btn btn-outline-light" id="btnCopy">Copy to Clipboard</button>
              <button class="btn btn-outline-danger ms-auto" id="btnClear">Clear</button>
            </div>
          </div>
        </div>

        <!-- Right: Preview -->
        <div class="col-12 col-lg-6">
          <div class="card app-card p-3 p-md-4 h-100">
            <div class="qr-wrap mb-3">
              <div id="qr"></div>
            </div>
            <div class="small footer">
              Tip: Use <span class="text-light">H</span> error correction when adding big logos. Always test your codes with multiple scanners.
            </div>
          </div>
        </div>
      </div>

      <div class="text-center mt-4 footer">Built with ❤️ using Bootstrap & qr-code-styling. Works entirely offline after first load.</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // --- Helpers to build payloads ---
      function escapeWifi(text = "") {
        return String(text).replace(/([\\;,:\"]) /g, '\\$1').replace(/"/g, '\\"');
      }
      function buildWifi({ ssid, pass, auth, hidden }) {
        const p = pass || "";
        const h = hidden ? ";H:true" : "";
        return `WIFI:T:${auth};S:${escapeWifi(ssid)};P:${escapeWifi(p)}${auth==='nopass'?'':""}${h};;`;
      }
      function buildVCard(v) {
        const lines = [
          "BEGIN:VCARD",
          "VERSION:3.0",
          `N:${v.last||''};${v.first||''};;;`,
          `FN:${[v.first||'', v.last||''].filter(Boolean).join(' ')}`,
          v.org ? `ORG:${v.org}` : null,
          v.title ? `TITLE:${v.title}` : null,
          v.phone ? `TEL;TYPE=CELL:${v.phone}` : null,
          v.email ? `EMAIL:${v.email}` : null,
          v.addr ? `ADR;TYPE=HOME:;;${v.addr};;;;` : null,
          v.url ? `URL:${v.url}` : null,
          "END:VCARD"
        ].filter(Boolean);
        return lines.join("\n");
      }
      function buildSMS(to, msg) {
        const u = new URLSearchParams({ body: msg||"" }).toString();
        return `SMSTO:${to||''}:${msg||''}`; // many scanners support SMSTO schema
      }
      function buildEmail(to, subject, body) {
        const qp = new URLSearchParams();
        if (subject) qp.set('subject', subject);
        if (body) qp.set('body', body);
        return `mailto:${to||''}${qp.toString()?'?'+qp.toString():''}`;
      }

      // --- State ---
      const el = {
        text: document.getElementById('textContent'),
        wifi: { ssid: document.getElementById('wifiSsid'), pass: document.getElementById('wifiPass'), auth: document.getElementById('wifiAuth'), hidden: document.getElementById('wifiHidden') },
        v: { first: document.getElementById('vFirst'), last: document.getElementById('vLast'), phone: document.getElementById('vPhone'), email: document.getElementById('vEmail'), org: document.getElementById('vOrg'), title: document.getElementById('vTitle'), addr: document.getElementById('vAddr'), url: document.getElementById('vUrl') },
        sms: { to: document.getElementById('smsTo'), msg: document.getElementById('smsMsg') },
        email: { to: document.getElementById('emTo'), subject: document.getElementById('emSubject'), body: document.getElementById('emBody') },
        size: document.getElementById('size'), sizeOut: document.getElementById('sizeOut'),
        margin: document.getElementById('margin'), marginOut: document.getElementById('marginOut'),
        ecc: document.getElementById('ecc'),
        dotStyle: document.getElementById('dotStyle'),
        fg: document.getElementById('fg'), bg: document.getElementById('bg'),
        logo: document.getElementById('logo'), logoSize: document.getElementById('logoSize'), logoOut: document.getElementById('logoOut'),
        qr: document.getElementById('qr'),
        btnGenerate: document.getElementById('btnGenerate'),
        btnRefresh: document.getElementById('btnRefresh'),
        btnPng: document.getElementById('btnDownloadPng'),
        btnSvg: document.getElementById('btnDownloadSvg'),
        btnCopy: document.getElementById('btnCopy'),
        btnClear: document.getElementById('btnClear')
      };

      // Output mirrors
      el.size.addEventListener('input', () => el.sizeOut.textContent = el.size.value);
      el.margin.addEventListener('input', () => el.marginOut.textContent = el.margin.value);
      el.logoSize.addEventListener('input', () => el.logoOut.textContent = el.logoSize.value);

      // QR instance
      let qr = new QRCodeStyling({
        width: parseInt(el.size.value, 10),
        height: parseInt(el.size.value, 10),
        data: "",
        margin: parseInt(el.margin.value, 10),
        qrOptions: {
          typeNumber: 0,
          mode: "Byte",
          errorCorrectionLevel: el.ecc.value
        },
        // Appearance
        dotsOptions: { type: el.dotStyle.value, color: el.fg.value },
        backgroundOptions: { color: el.bg.value },
        imageOptions: { crossOrigin: "anonymous", imageSize: parseFloat(el.logoSize.value) }
      });
      qr.append(el.qr);

      // Read file as dataURL
      function fileToDataURL(file) {
        return new Promise((res, rej) => {
          const fr = new FileReader();
          fr.onload = () => res(fr.result);
          fr.onerror = rej;
          fr.readAsDataURL(file);
        });
      }

      let logoData = null;
      el.logo.addEventListener('change', async () => {
        if (el.logo.files && el.logo.files[0]) {
          logoData = await fileToDataURL(el.logo.files[0]);
        } else {
          logoData = null;
        }
      });

      function currentPayload() {
        const active = document.querySelector('#dataTabs .nav-link.active')?.id;
        switch (active) {
          case 'tab-wifi':
            return buildWifi({ ssid: el.wifi.ssid.value, pass: el.wifi.pass.value, auth: el.wifi.auth.value, hidden: el.wifi.hidden.checked });
          case 'tab-vcard':
            return buildVCard({ first: el.v.first.value, last: el.v.last.value, phone: el.v.phone.value, email: el.v.email.value, org: el.v.org.value, title: el.v.title.value, addr: el.v.addr.value, url: el.v.url.value });
          case 'tab-sms':
            return buildSMS(el.sms.to.value, el.sms.msg.value);
          case 'tab-email':
            return buildEmail(el.email.to.value, el.email.subject.value, el.email.body.value);
          default:
            return el.text.value || '';
        }
      }

      async function renderQR() {
        const size = parseInt(el.size.value, 10);
        const margin = parseInt(el.margin.value, 10);
        const ecc = el.ecc.value;
        const dotStyle = el.dotStyle.value;
        const fg = el.fg.value;
        const bg = el.bg.value;
        const imgSize = parseFloat(el.logoSize.value);

        const update = {
          width: size,
          height: size,
          data: currentPayload(),
          margin,
          qrOptions: { errorCorrectionLevel: ecc },
          dotsOptions: { type: dotStyle, color: fg },
          backgroundOptions: { color: bg },
          imageOptions: { imageSize: imgSize }
        };
        if (logoData) update.image = logoData; else update.image = null;
        await qr.update(update);
      }

      el.btnGenerate.addEventListener('click', renderQR);
      el.btnRefresh.addEventListener('click', renderQR);
      document.getElementById('dataTabs').addEventListener('click', () => setTimeout(renderQR, 100));

      el.btnPng.addEventListener('click', async () => {
        await renderQR();
        qr.download({ name: 'qr-code', extension: 'png' });
      });
      el.btnSvg.addEventListener('click', async () => {
        await renderQR();
        qr.download({ name: 'qr-code', extension: 'svg' });
      });
      el.btnCopy.addEventListener('click', async () => {
        await renderQR();
        try {
          const blob = await qr.getRawData('png');
          await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
          alert('Copied QR PNG to clipboard!');
        } catch (e) {
          alert('Copy failed in this browser. Download instead.');
        }
      });
      el.btnClear.addEventListener('click', () => {
        el.text.value = '';
        ['ssid','pass'].forEach(k => el.wifi[k].value='');
        el.v.first.value = el.v.last.value = el.v.phone.value = el.v.email.value = '';
        el.v.org.value = el.v.title.value = el.v.addr.value = el.v.url.value = '';
        el.sms.to.value = el.sms.msg.value = '';
        el.email.to.value = el.email.subject.value = el.email.body.value = '';
        logoData = null; el.logo.value = '';
        renderQR();
      });

      // Initial demo value
      el.text.value = 'https://example.com/?ref=qr';
      renderQR();
    </script>
  </body>
</html>